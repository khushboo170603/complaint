{% extends 'base.html' %}
{% load static %}

{% block title %}Complaint Detail{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto mt-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Complaint Detail</h2>

    <!-- üé´ General Details -->
    <h3 class="text-lg font-semibold text-gray-700 mb-2">General Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-6">
        <div><p class="font-semibold">Ticket Number:</p><p>{{ complaint.ticket_number }}</p></div>
        <div><p class="font-semibold">Customer Name:</p><p>{{ complaint.customer_name }}</p></div>
        <div><p class="font-semibold">Email:</p><p>{{ complaint.email|default:"-" }}</p></div>
        <div><p class="font-semibold">Mobile Number:</p><p>{{ complaint.mobile_number }}</p></div>
        <div class="md:col-span-2">
        <p class="font-semibold mb-1">Customer Address:</p>
            
                {% if complaint.street %}<div><strong>Street:</strong> {{ complaint.street }}</div>{% endif %}
                {% if complaint.area %}<div><strong>Area:</strong> {{ complaint.area }}</div>{% endif %}
                {% if complaint.landmark %}<div><strong>Landmark:</strong> {{ complaint.landmark }}</div>{% endif %}
                {% if complaint.city %}<div><strong>City:</strong> {{ complaint.city }}</div>{% endif %}
                {% if complaint.state %}<div><strong>State:</strong> {{ complaint.state }}</div>{% endif %}
                {% if complaint.pincode %}<div><strong>Pincode:</strong> {{ complaint.pincode }}</div>{% endif %}
            
        </div>


        <div><p class="font-semibold">Product:</p><p>{{ complaint.product }}</p></div>
        <div><p class="font-semibold">Issue Type:</p><p>{{ complaint.issue_type }}</p></div>
        <div><p class="font-semibold">Status:</p><p>{{ complaint.get_status_display }}</p></div>
        <div><p class="font-semibold">Assigned Engineer:</p><p>{{ complaint.assigned_engineer.username|default:"Not Assigned" }}</p></div>
        <div><p class="font-semibold">Created At:</p><p>{{ complaint.created_at|date:"Y-m-d H:i" }}</p></div>
        <div><p class="font-semibold">Last Updated:</p><p>{{ complaint.updated_at|date:"Y-m-d H:i" }}</p></div>
        <div class="md:col-span-2">
            <p class="font-semibold">Description:</p>
            <p class="whitespace-pre-line">{{ complaint.description }}</p>
        </div>
    </div>

    <!-- ‚öôÔ∏è Service Details -->
    <h3 class="text-lg font-semibold text-gray-700 mb-2">Service Details</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-6">
        {% if complaint.product_serial_number %}
            <div>
                <p class="font-semibold">Product Serial Number:</p>
                <p>{{ complaint.product_serial_number }}</p>
            </div>
        {% endif %}

        {% if complaint.service_confirmation_photo %}
            <div class="md:col-span-2">
                <p class="font-semibold mb-1">Service Confirmation Photo:</p>
                <a href="{{ complaint.service_confirmation_photo.url }}" target="_blank">
                    <img src="{{ complaint.service_confirmation_photo.url }}" alt="Service Confirmation"
                         class="w-32 h-32 object-cover rounded shadow hover:scale-105 transition-transform duration-300">
                </a>
            </div>
        {% endif %}

        {% if complaint.resolution_photo %}
            <div class="md:col-span-2">
                <p class="font-semibold mb-1">Resolution Photo:</p>
                <a href="{{ complaint.resolution_photo.url }}" target="_blank">
                    <img src="{{ complaint.resolution_photo.url }}" alt="Resolution Photo"
                         class="w-32 h-32 object-cover rounded shadow hover:scale-105 transition-transform duration-300">
                </a>
            </div>
        {% endif %}
    </div>

    <!-- üí∞ Payment Details -->
    <h3 class="text-lg font-semibold text-gray-700 mb-2">Payment Details</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm mb-6">
        {% if complaint.service_cost %}
            <div><p class="font-semibold">Service Cost:</p><p>‚Çπ {{ complaint.service_cost }}</p></div>
        {% endif %}

        {% if complaint.payment_method %}
            <div><p class="font-semibold">Payment Method:</p><p>{{ complaint.payment_method|capfirst }}</p></div>
        {% endif %}

        {% if complaint.payment_confirmation_photo %}
            <div class="md:col-span-2">
                <p class="font-semibold mb-1">Engineer Uploaded Payment Confirmation:</p>
                <a href="{{ complaint.payment_confirmation_photo.url }}" target="_blank">
                    <img src="{{ complaint.payment_confirmation_photo.url }}" alt="Payment Confirmation"
                         class="w-32 h-32 object-cover rounded shadow hover:scale-105 transition-transform duration-300">
                </a>
            </div>
        {% endif %}
    </div>

    <!-- üì© SMS Log -->
    {% if complaint.sms_log %}
        <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-700 mb-2">SMS Log</h3>
            <p class="bg-gray-100 p-3 rounded text-sm whitespace-pre-line">{{ complaint.sms_log }}</p>
        </div>
    {% endif %}

    <!-- üîò Actions -->
    <div class="mt-6">
        {% if user.profile.role == "admin" or user.profile.role == "manager" %}
            <a href="{% url 'complaint_edit' complaint.pk %}" class="inline-block bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                Edit Complaint
            </a>
        {% endif %}
        <a href="{% url 'complaint_list' %}" class="inline-block ml-2 text-blue-600 hover:underline">
            ‚Üê Back to Complaint List
        </a>
    </div>
</div>
{% endblock %}
